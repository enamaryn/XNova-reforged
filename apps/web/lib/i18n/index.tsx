"use client";

import {
  createContext,
  useCallback,
  useContext,
  useEffect,
  useMemo,
  useState,
} from "react";

type Locale = "fr" | "en" | "es";

interface Dictionary {
  [key: string]: string | Dictionary;
}

const translations: Record<Locale, Dictionary> = {
  fr: {
    nav: {
      overview: "Vue",
      buildings: "Bâtiments",
      research: "Recherche",
      galaxy: "Galaxie",
      fleet: "Flotte",
      movement: "Mouvements",
      shipyard: "Chantier spatial",
      defense: "Défense",
      alliance: "Alliance",
      messages: "Messages",
      statistics: "Statistiques",
      reports: "Rapports",
      options: "Options",
      admin: "Admin",
      label: "Navigation principale",
      languageMenu: "Choix de la langue",
      userMenu: "Menu utilisateur",
    },
    sidebar: {
      principal: "Principal",
      construction: "Construction",
      fleet: "Flotte & Exploration",
      social: "Social",
      other: "Autre",
      quickAccess: "Accès rapide",
      planetView: "Vue planète",
    },
    fleet: {
      title: "Flotte",
      subtitle: "Préparez vos mouvements et missions.",
      compose: "Composer une flotte",
      availableShips: "Vaisseaux disponibles",
      mission: "Mission",
      destination: "Destination",
      sendSoon: "Envoyer la flotte (bientôt)",
      active: "Flottes en cours",
      none: "Aucune flotte en déplacement.",
      last: "Dernière mission : aucune.",
      missions: {
        transport: "Transport",
        attack: "Attaque",
        spy: "Espionnage",
        colonize: "Colonisation",
        deploy: "Déploiement",
      },
      summary: "Résumé de mission",
      distance: "Distance",
      duration: "Durée estimée",
      fuel: "Consommation",
      capacity: "Capacité cargo",
      cargoSelected: "Cargaison",
    },
    movement: {
      kicker: "Centre de trafic",
      title: "Mouvements",
      subtitle: "Suivez vos flottes et leurs retours.",
      active: "Flottes actives",
      tracking: "Trafic spatial",
      refresh: "Mise à jour toutes les 10s",
      empty: "Aucune flotte en mouvement.",
      arrivalIn: "Arrivée dans",
      backIn: "Retour dans",
      recall: "Rappeler",
      recalling: "Rappel...",
      fleetSize: "Vaisseaux",
      status: {
        traveling: "En route",
        returning: "Retour",
        arrived: "Arrivé",
        completed: "Terminé",
      },
    },
    galaxy: {
      title: "Galaxie",
      subtitle: "Naviguez dans l’univers et repérez les systèmes disponibles.",
      scanSoon: "Scanner (bientôt)",
      freeSlot: "Position libre",
      loading: "Chargement du système...",
      activity: "Activité",
      activeNow: "Actif",
      moon: "Lune",
    },
    messages: {
      kicker: "Communication",
      title: "Messages",
      subtitle: "Gérez vos communications avec les autres commandants.",
      loading: "Chargement des messages...",
      inbox: "Boîte de réception",
      items: "messages",
      empty: "Aucun message",
      emptyHint: "Envoyez un message pour démarrer une conversation.",
      read: "Lu",
      unread: "Non lu",
      from: "De",
      compose: "Nouveau message",
      toPlaceholder: "Destinataire (pseudo)",
      subjectPlaceholder: "Sujet",
      bodyPlaceholder: "Votre message...",
      send: "Envoyer",
      sending: "Envoi...",
      detail: "Lecture",
      selectHint: "Sélectionnez un message pour le lire.",
      delete: "Supprimer",
      deleting: "Suppression...",
    },
    alliance: {
      kicker: "Diplomatie",
      title: "Alliance",
      subtitle: "Créez ou rejoignez une alliance pour progresser ensemble.",
      loading: "Chargement de l'alliance...",
      create: "Créer une alliance",
      createAction: "Créer",
      creating: "Création...",
      tagPlaceholder: "Tag (ex: XNOVA)",
      namePlaceholder: "Nom complet",
      descriptionPlaceholder: "Description",
      join: "Rejoindre une alliance",
      joinHint: "Entrez l'identifiant d'alliance reçu par message.",
      joinPlaceholder: "ID d'alliance",
      joinAction: "Rejoindre",
      joining: "Rejoindre...",
      createdAt: "Créée le",
      members: "Membres",
      players: "joueurs",
      points: "Points",
      invite: "Inviter un joueur",
      invitePlaceholder: "Pseudo du joueur",
      inviteAction: "Inviter",
      inviting: "Invitation...",
      leave: "Quitter l'alliance",
      leaveHint: "Vous quitterez l'alliance immédiatement.",
      leaveBlocked: "Le fondateur ne peut pas quitter sans dissoudre.",
      leaveAction: "Quitter",
      leaving: "Départ...",
    },
    statistics: {
      kicker: "Commandement",
      title: "Statistiques",
      subtitle: "Classements et progression personnelle.",
      loading: "Chargement des statistiques...",
      personal: "Vos stats",
      playerRank: "Classement joueur",
      points: "Points",
      planets: "Planètes",
      alliance: "Alliance",
      none: "Aucune",
      topPlayers: "Top joueurs",
      topAlliances: "Top alliances",
      members: "membres",
      emptyPlayers: "Aucun joueur classé",
      emptyAlliances: "Aucune alliance classée",
    },
    settings: {
      kicker: "Préférences",
      title: "Paramètres",
      subtitle: "Gérez votre compte et l'interface.",
      account: "Compte",
      accountHint: "Identité, sécurité et emails.",
      accountTodo: "Gestion du mot de passe et des emails à venir.",
      interface: "Interface",
      interfaceHint: "Langue, affichage et confort de jeu.",
      interfaceTodo: "Options visuelles et notifications en préparation.",
    },
    admin: {
      kicker: "Administration",
      title: "Console admin",
      subtitle: "Configuration et supervision du serveur.",
      backToGame: "Retour au jeu",
      noAccess: "Accès réservé aux administrateurs.",
      loading: "Chargement des paramètres...",
      overview: "Vue générale",
      overviewHint: "Etat rapide du serveur et de la population.",
      players: "Joueurs",
      online: "En ligne",
      planets: "Planètes",
      alliances: "Alliances",
      config: "Configuration serveur",
      configHint: "Modifiez les paramètres globaux en direct.",
      savedAt: "Sauvegardé à",
      gameSpeed: "Vitesse du jeu",
      fleetSpeed: "Vitesse des flottes",
      productionSpeed: "Vitesse de production",
      buildingCostMultiplier: "Multiplicateur batiments",
      researchCostMultiplier: "Multiplicateur recherches",
      shipCostMultiplier: "Multiplicateur vaisseaux",
      planetSize: "Taille planète",
      maxBuildingLevel: "Niveau max batiments",
      maxTechnologyLevel: "Niveau max technologies",
      baseMetal: "Base métal",
      baseCrystal: "Base cristal",
      baseDeuterium: "Base deutérium",
      save: "Sauvegarder",
      saving: "Sauvegarde...",
      roleTitle: "Gestion des roles",
      roleHint: "Promouvoir un joueur ou ajuster ses permissions.",
      boostTitle: "Developpement total",
      boostHint: "Passe tous les batiments et technologies au niveau 100.",
      usernameLabel: "Pseudo",
      usernamePlaceholder: "Nom du joueur",
      rolePlayer: "Joueur",
      roleModerator: "Moderateur",
      roleAdmin: "Administrateur",
      roleSuperAdmin: "Super admin",
      roleUpdate: "Mettre a jour",
      roleUpdating: "Mise a jour...",
      boostAction: "Booster",
      boostProcessing: "Boost en cours...",
      boostSuccess: "Boost applique",
      boostPlanets: "planetes",
      boostTechs: "technologies",
      boostBuildingLevel: "niveau batiments",
      boostTechnologyLevel: "niveau technologies",
      moderationTitle: "Moderation",
      moderationHint: "Bannir ou debannir un joueur rapidement.",
      reasonPlaceholder: "Raison (optionnel)",
      days: "Jours",
      hours: "Heures",
      minutes: "Minutes",
      banAction: "Bannir",
      banProcessing: "Bannissement...",
      unbanAction: "Debannir",
      unbanProcessing: "Debannissement...",
      auditTitle: "Journal admin",
      auditHint: "Dernieres actions sensibles.",
      auditEmpty: "Aucune action recente.",
      banTitle: "Historique des sanctions",
      banHint: "Derniers bannissements et debannissements.",
      banEmpty: "Aucune sanction recente.",
      by: "Par",
      expiresAt: "Expire le",
    },
    common: {
      language: "Langue",
      contact: "Contact",
      you: "Vous",
      loading: "Chargement...",
      retry: "Réessayer",
      error: "Erreur de chargement.",
    },
    techCategory: {
      basic: "Fondations",
      drive: "Propulsions",
      advanced: "Avancé",
      combat: "Combat",
    },
  },
  en: {
    nav: {
      overview: "Overview",
      buildings: "Buildings",
      research: "Research",
      galaxy: "Galaxy",
      fleet: "Fleet",
      movement: "Movements",
      shipyard: "Shipyard",
      defense: "Defense",
      alliance: "Alliance",
      messages: "Messages",
      statistics: "Statistics",
      reports: "Reports",
      options: "Options",
      admin: "Admin",
      label: "Main navigation",
      languageMenu: "Language switcher",
      userMenu: "User menu",
    },
    sidebar: {
      principal: "Main",
      construction: "Construction",
      fleet: "Fleet & Exploration",
      social: "Social",
      other: "Other",
      quickAccess: "Quick Access",
      planetView: "Planet View",
    },
    fleet: {
      title: "Fleet",
      subtitle: "Prepare your moves and missions.",
      compose: "Compose a fleet",
      availableShips: "Available ships",
      mission: "Mission",
      destination: "Destination",
      sendSoon: "Send fleet (soon)",
      active: "Active fleets",
      none: "No fleets in transit.",
      last: "Last mission: none.",
      missions: {
        transport: "Transport",
        attack: "Attack",
        spy: "Espionage",
        colonize: "Colonization",
        deploy: "Deploy",
      },
      summary: "Mission summary",
      distance: "Distance",
      duration: "Estimated duration",
      fuel: "Consumption",
      capacity: "Cargo capacity",
      cargoSelected: "Cargo",
    },
    movement: {
      kicker: "Traffic control",
      title: "Movements",
      subtitle: "Track your fleets and returns.",
      active: "Active fleets",
      tracking: "Space traffic",
      refresh: "Refresh every 10s",
      empty: "No fleets in motion.",
      arrivalIn: "Arrival in",
      backIn: "Back in",
      recall: "Recall",
      recalling: "Recalling...",
      fleetSize: "Ships",
      status: {
        traveling: "En route",
        returning: "Returning",
        arrived: "Arrived",
        completed: "Completed",
      },
    },
    galaxy: {
      title: "Galaxy",
      subtitle: "Navigate the universe and spot available systems.",
      scanSoon: "Scan (soon)",
      freeSlot: "Empty slot",
      loading: "Loading system...",
      activity: "Activity",
      activeNow: "Online",
      moon: "Moon",
    },
    messages: {
      kicker: "Communication",
      title: "Messages",
      subtitle: "Manage your communications with other commanders.",
      loading: "Loading messages...",
      inbox: "Inbox",
      items: "messages",
      empty: "No messages",
      emptyHint: "Send a message to start a conversation.",
      read: "Read",
      unread: "Unread",
      from: "From",
      compose: "New message",
      toPlaceholder: "Recipient (username)",
      subjectPlaceholder: "Subject",
      bodyPlaceholder: "Your message...",
      send: "Send",
      sending: "Sending...",
      detail: "Reading",
      selectHint: "Select a message to read it.",
      delete: "Delete",
      deleting: "Deleting...",
    },
    alliance: {
      kicker: "Diplomacy",
      title: "Alliance",
      subtitle: "Create or join an alliance to progress together.",
      loading: "Loading alliance...",
      create: "Create an alliance",
      createAction: "Create",
      creating: "Creating...",
      tagPlaceholder: "Tag (ex: XNOVA)",
      namePlaceholder: "Full name",
      descriptionPlaceholder: "Description",
      join: "Join an alliance",
      joinHint: "Enter the alliance id received by message.",
      joinPlaceholder: "Alliance ID",
      joinAction: "Join",
      joining: "Joining...",
      createdAt: "Created on",
      members: "Members",
      players: "players",
      points: "Points",
      invite: "Invite a player",
      invitePlaceholder: "Player username",
      inviteAction: "Invite",
      inviting: "Inviting...",
      leave: "Leave alliance",
      leaveHint: "You will leave the alliance immediately.",
      leaveBlocked: "The founder cannot leave without dissolving.",
      leaveAction: "Leave",
      leaving: "Leaving...",
    },
    statistics: {
      kicker: "Command",
      title: "Statistics",
      subtitle: "Rankings and personal progression.",
      loading: "Loading statistics...",
      personal: "Your stats",
      playerRank: "Player rank",
      points: "Points",
      planets: "Planets",
      alliance: "Alliance",
      none: "None",
      topPlayers: "Top players",
      topAlliances: "Top alliances",
      members: "members",
      emptyPlayers: "No ranked players",
      emptyAlliances: "No ranked alliances",
    },
    settings: {
      kicker: "Preferences",
      title: "Settings",
      subtitle: "Manage your account and interface.",
      account: "Account",
      accountHint: "Identity, security, and emails.",
      accountTodo: "Password and email management coming soon.",
      interface: "Interface",
      interfaceHint: "Language, display, and comfort.",
      interfaceTodo: "Visual options and notifications are in progress.",
    },
    admin: {
      kicker: "Administration",
      title: "Admin console",
      subtitle: "Server configuration and supervision.",
      backToGame: "Back to game",
      noAccess: "Admins only.",
      loading: "Loading settings...",
      overview: "Overview",
      overviewHint: "Quick server and population status.",
      players: "Players",
      online: "Online",
      planets: "Planets",
      alliances: "Alliances",
      config: "Server configuration",
      configHint: "Update global parameters live.",
      savedAt: "Saved at",
      gameSpeed: "Game speed",
      fleetSpeed: "Fleet speed",
      productionSpeed: "Production speed",
      buildingCostMultiplier: "Building cost multiplier",
      researchCostMultiplier: "Research cost multiplier",
      shipCostMultiplier: "Ship cost multiplier",
      planetSize: "Planet size",
      maxBuildingLevel: "Max building level",
      maxTechnologyLevel: "Max technology level",
      baseMetal: "Base metal",
      baseCrystal: "Base crystal",
      baseDeuterium: "Base deuterium",
      save: "Save",
      saving: "Saving...",
      roleTitle: "Role management",
      roleHint: "Promote a player or adjust permissions.",
      boostTitle: "Full development",
      boostHint: "Set all buildings and technologies to level 100.",
      usernameLabel: "Username",
      usernamePlaceholder: "Player name",
      rolePlayer: "Player",
      roleModerator: "Moderator",
      roleAdmin: "Admin",
      roleSuperAdmin: "Super admin",
      roleUpdate: "Update role",
      roleUpdating: "Updating...",
      boostAction: "Boost",
      boostProcessing: "Boosting...",
      boostSuccess: "Boost applied",
      boostPlanets: "planets",
      boostTechs: "technologies",
      boostBuildingLevel: "building level",
      boostTechnologyLevel: "technology level",
      moderationTitle: "Moderation",
      moderationHint: "Ban or unban a player quickly.",
      reasonPlaceholder: "Reason (optional)",
      days: "Days",
      hours: "Hours",
      minutes: "Minutes",
      banAction: "Ban",
      banProcessing: "Banning...",
      unbanAction: "Unban",
      unbanProcessing: "Unbanning...",
      auditTitle: "Admin log",
      auditHint: "Latest sensitive actions.",
      auditEmpty: "No recent actions.",
      banTitle: "Sanction history",
      banHint: "Recent bans and unbans.",
      banEmpty: "No recent sanctions.",
      by: "By",
      expiresAt: "Expires at",
    },
    common: {
      language: "Language",
      contact: "Contact",
      you: "You",
      loading: "Loading...",
      retry: "Retry",
      error: "Loading error.",
    },
    techCategory: {
      basic: "Foundations",
      drive: "Drives",
      advanced: "Advanced",
      combat: "Combat",
    },
  },
  es: {
    nav: {
      overview: "Resumen",
      buildings: "Edificios",
      research: "Investigación",
      galaxy: "Galaxia",
      fleet: "Flota",
      movement: "Movimientos",
      shipyard: "Astillero",
      defense: "Defensa",
      alliance: "Alianza",
      messages: "Mensajes",
      statistics: "Estadísticas",
      reports: "Reportes",
      options: "Opciones",
      admin: "Admin",
      label: "Navegación principal",
      languageMenu: "Selector de idioma",
      userMenu: "Menú de usuario",
    },
    sidebar: {
      principal: "Principal",
      construction: "Construcción",
      fleet: "Flota y Exploración",
      social: "Social",
      other: "Otros",
      quickAccess: "Acceso rápido",
      planetView: "Vista planeta",
    },
    fleet: {
      title: "Flota",
      subtitle: "Prepara tus movimientos y misiones.",
      compose: "Componer una flota",
      availableShips: "Naves disponibles",
      mission: "Misión",
      destination: "Destino",
      sendSoon: "Enviar flota (pronto)",
      active: "Flotas activas",
      none: "No hay flotas en tránsito.",
      last: "Última misión: ninguna.",
      missions: {
        transport: "Transporte",
        attack: "Ataque",
        spy: "Espionaje",
        colonize: "Colonización",
        deploy: "Despliegue",
      },
      summary: "Resumen de misión",
      distance: "Distancia",
      duration: "Duración estimada",
      fuel: "Consumo",
      capacity: "Capacidad de carga",
      cargoSelected: "Carga",
    },
    movement: {
      kicker: "Control de tráfico",
      title: "Movimientos",
      subtitle: "Sigue tus flotas y sus retornos.",
      active: "Flotas activas",
      tracking: "Tráfico espacial",
      refresh: "Actualización cada 10s",
      empty: "No hay flotas en movimiento.",
      arrivalIn: "Llega en",
      backIn: "Regresa en",
      recall: "Retirar",
      recalling: "Retirando...",
      fleetSize: "Naves",
      status: {
        traveling: "En ruta",
        returning: "Regresando",
        arrived: "Llegó",
        completed: "Completado",
      },
    },
    galaxy: {
      title: "Galaxia",
      subtitle: "Navega el universo y detecta sistemas disponibles.",
      scanSoon: "Escanear (pronto)",
      freeSlot: "Posición libre",
      loading: "Cargando sistema...",
      activity: "Actividad",
      activeNow: "Activo",
      moon: "Luna",
    },
    messages: {
      kicker: "Comunicacion",
      title: "Mensajes",
      subtitle: "Gestiona tus comunicaciones con otros comandantes.",
      loading: "Cargando mensajes...",
      inbox: "Bandeja de entrada",
      items: "mensajes",
      empty: "No hay mensajes",
      emptyHint: "Envia un mensaje para iniciar una conversacion.",
      read: "Leido",
      unread: "No leido",
      from: "De",
      compose: "Nuevo mensaje",
      toPlaceholder: "Destinatario (usuario)",
      subjectPlaceholder: "Asunto",
      bodyPlaceholder: "Tu mensaje...",
      send: "Enviar",
      sending: "Enviando...",
      detail: "Lectura",
      selectHint: "Selecciona un mensaje para leerlo.",
      delete: "Eliminar",
      deleting: "Eliminando...",
    },
    alliance: {
      kicker: "Diplomacia",
      title: "Alianza",
      subtitle: "Crea o unete a una alianza para progresar juntos.",
      loading: "Cargando alianza...",
      create: "Crear una alianza",
      createAction: "Crear",
      creating: "Creando...",
      tagPlaceholder: "Tag (ej: XNOVA)",
      namePlaceholder: "Nombre completo",
      descriptionPlaceholder: "Descripcion",
      join: "Unirse a una alianza",
      joinHint: "Introduce el id de alianza recibido por mensaje.",
      joinPlaceholder: "ID de alianza",
      joinAction: "Unirse",
      joining: "Uniendose...",
      createdAt: "Creada el",
      members: "Miembros",
      players: "jugadores",
      points: "Puntos",
      invite: "Invitar a un jugador",
      invitePlaceholder: "Usuario del jugador",
      inviteAction: "Invitar",
      inviting: "Invitando...",
      leave: "Salir de la alianza",
      leaveHint: "Saldras de la alianza inmediatamente.",
      leaveBlocked: "El fundador no puede salir sin disolver.",
      leaveAction: "Salir",
      leaving: "Saliendo...",
    },
    statistics: {
      kicker: "Mando",
      title: "Estadisticas",
      subtitle: "Clasificaciones y progreso personal.",
      loading: "Cargando estadisticas...",
      personal: "Tus estadisticas",
      playerRank: "Clasificacion del jugador",
      points: "Puntos",
      planets: "Planetas",
      alliance: "Alianza",
      none: "Ninguna",
      topPlayers: "Top jugadores",
      topAlliances: "Top alianzas",
      members: "miembros",
      emptyPlayers: "Sin jugadores clasificados",
      emptyAlliances: "Sin alianzas clasificadas",
    },
    settings: {
      kicker: "Preferencias",
      title: "Ajustes",
      subtitle: "Gestiona tu cuenta y la interfaz.",
      account: "Cuenta",
      accountHint: "Identidad, seguridad y correos.",
      accountTodo: "Gestion de contrasena y correos en camino.",
      interface: "Interfaz",
      interfaceHint: "Idioma, pantalla y comodidad.",
      interfaceTodo: "Opciones visuales y notificaciones en progreso.",
    },
    admin: {
      kicker: "Administracion",
      title: "Consola admin",
      subtitle: "Configuracion y supervision del servidor.",
      backToGame: "Volver al juego",
      noAccess: "Solo administradores.",
      loading: "Cargando ajustes...",
      overview: "Vista general",
      overviewHint: "Estado rapido del servidor y la poblacion.",
      players: "Jugadores",
      online: "En linea",
      planets: "Planetas",
      alliances: "Alianzas",
      config: "Configuracion del servidor",
      configHint: "Actualiza parametros globales en vivo.",
      savedAt: "Guardado a las",
      gameSpeed: "Velocidad del juego",
      fleetSpeed: "Velocidad de flotas",
      productionSpeed: "Velocidad de produccion",
      buildingCostMultiplier: "Multiplicador edificios",
      researchCostMultiplier: "Multiplicador investigaciones",
      shipCostMultiplier: "Multiplicador naves",
      planetSize: "Tamano de planeta",
      maxBuildingLevel: "Nivel max edificios",
      maxTechnologyLevel: "Nivel max tecnologias",
      baseMetal: "Base metal",
      baseCrystal: "Base cristal",
      baseDeuterium: "Base deuterio",
      save: "Guardar",
      saving: "Guardando...",
      roleTitle: "Gestion de roles",
      roleHint: "Promover a un jugador o ajustar permisos.",
      boostTitle: "Desarrollo total",
      boostHint: "Pone todos los edificios y tecnologias al nivel 100.",
      usernameLabel: "Usuario",
      usernamePlaceholder: "Nombre del jugador",
      rolePlayer: "Jugador",
      roleModerator: "Moderador",
      roleAdmin: "Admin",
      roleSuperAdmin: "Super admin",
      roleUpdate: "Actualizar",
      roleUpdating: "Actualizando...",
      boostAction: "Potenciar",
      boostProcessing: "Potenciando...",
      boostSuccess: "Impulso aplicado",
      boostPlanets: "planetas",
      boostTechs: "tecnologias",
      boostBuildingLevel: "nivel edificios",
      boostTechnologyLevel: "nivel tecnologias",
      moderationTitle: "Moderacion",
      moderationHint: "Bloquear o desbloquear rapidamente.",
      reasonPlaceholder: "Razon (opcional)",
      days: "Dias",
      hours: "Horas",
      minutes: "Minutos",
      banAction: "Bloquear",
      banProcessing: "Bloqueando...",
      unbanAction: "Desbloquear",
      unbanProcessing: "Desbloqueando...",
      auditTitle: "Registro admin",
      auditHint: "Ultimas acciones sensibles.",
      auditEmpty: "Sin acciones recientes.",
      banTitle: "Historial de sanciones",
      banHint: "Ultimos bloqueos y desbloqueos.",
      banEmpty: "Sin sanciones recientes.",
      by: "Por",
      expiresAt: "Expira el",
    },
    common: {
      language: "Idioma",
      contact: "Contacto",
      you: "Tú",
      loading: "Cargando...",
      retry: "Reintentar",
      error: "Error de carga.",
    },
    techCategory: {
      basic: "Fundamentos",
      drive: "Propulsión",
      advanced: "Avanzado",
      combat: "Combate",
    },
  },
};

interface I18nContextValue {
  locale: Locale;
  setLocale: (locale: Locale) => void;
  t: (key: string) => string;
}

const I18nContext = createContext<I18nContextValue | undefined>(undefined);

function resolveKey(dictionary: Dictionary, key: string): string | undefined {
  const parts = key.split(".");
  let current: Dictionary | string | undefined = dictionary;
  for (const part of parts) {
    if (!current || typeof current === "string") return undefined;
    current = current[part];
  }
  return typeof current === "string" ? current : undefined;
}

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [locale, setLocale] = useState<Locale>("fr");

  useEffect(() => {
    if (typeof window === "undefined") return;
    const stored = window.localStorage.getItem("xnova-locale") as Locale | null;
    if (stored && ["fr", "en", "es"].includes(stored)) {
      setLocale(stored);
    }
  }, []);

  const handleSetLocale = useCallback((next: Locale) => {
    setLocale(next);
    if (typeof window !== "undefined") {
      window.localStorage.setItem("xnova-locale", next);
    }
  }, []);

  const t = useCallback(
    (key: string) => {
      const dictionary = translations[locale];
      return resolveKey(dictionary, key) ?? key;
    },
    [locale],
  );

  const value = useMemo(
    () => ({
      locale,
      setLocale: handleSetLocale,
      t,
    }),
    [locale, handleSetLocale, t],
  );

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  const context = useContext(I18nContext);
  if (!context) {
    throw new Error("useI18n doit être utilisé dans un I18nProvider");
  }
  return context;
}
